```{r message=FALSE, warning=FALSE}
library(dplyr)
library(readxl)
library(ggplot2)
library(lubridate)
```



```{r}
gdrive_path <- paste(LETTERS[file.exists(paste0(LETTERS, ":/My Drive"))],":/My Drive",sep = "")
project_path <- file.path(gdrive_path,"Academic_git/DownScaling")
generalData_path <- file.path(gdrive_path,"General_Data")
```




```{r}
# 2. Read the data 
df <- read_excel(file.path(generalData_path,"EL08_precipitation.xlsx"),col_names = FALSE)

colnames(df)[2] <- "datetime"
colnames(df)[3:ncol(df)]<-seq(3,ncol(df),1)

df$datetime<-format(as.Date(df$datetime), "%Y%m%d")


for (station_column in 3:ncol(df)) {
 


station_column<-3

#3 is the station
values <-df[[station_column]][8:nrow(df)]

values[is.na(values) | values == ""] <- c(-999)
  
starting_index<-7+which(values!="-999")[1]
end_index<-7+tail(which(values!="-999"),1)
 
 
start_dt <- df$datetime[starting_index]
end_dt <- df$datetime[end_index]
 
num_records <- end_index-starting_index
percent_missing <- round((sum(values[starting_index:end_index] == -999) / num_records) * 100, 2)
  

  header <- c(
    paste0("Station ID: ", paste0("EL04_S",station_column-2)),
    paste0("Country: Greece"),  
    paste0("Original Station Name: ",  df[[station_column]][1]),
    paste0("Source: ", "WD"),   
    paste0("Owner: ",df[[station_column]][5]),
    paste0("X: ", df[[station_column]][2]), 
    paste0("Y: ", df[[station_column]][3]), 
    paste0("Z: ", df[[station_column]][4]), 
    paste0("Start datetime: ", start_dt),
    paste0("End datetime: ", end_dt),
    paste0("Number of records: ", num_records),
    paste0("Percent missing data: ", format(percent_missing, nsmall=2)),
    "Original Timestep: 24hr",
    "Original Units: mm",
    "No data value: -999",""
  )
  
  # Combine header and the data values
  output_lines <- c(header, values[starting_index:end_index])
 
  # Write to the text file in the current WD
  output_filename <- paste0(df[[station_column]][1],"_",df[[station_column]][5], "_.txt")
  writeLines(output_lines, output_filename)
  
}



```




